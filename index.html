<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DSMNRU AI College Helpdesk</title>
<style>
    :root {
        --primary: #0d47a1;
        --secondary: #90caf9;
        --bg: #f0f4fb;
        --text: #333;
        --card: #ffffff;
    }

    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #a1c4fd, #c2e9fb);
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        transition: 0.3s;
    }

    .dark-mode {
        --bg: #1a1a1a;
        --text: #f0f0f0;
        --card: #2d2d2d;
        --primary: #1565c0;
        background: #121212;
    }

    .chat-container {
        width: 480px;
        max-width: 95%;
        height: 90vh;
        background: var(--card);
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }

    .chat-header {
        background: var(--primary);
        color: white;
        padding: 15px;
        text-align: center;
        font-size: 18px;
        font-weight: bold;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .header-btns button {
        background: rgba(255,255,255,0.2);
        border: none;
        color: white;
        padding: 5px 10px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 12px;
        margin-left: 5px;
    }

    .header-btns button:hover {
        background: rgba(255,255,255,0.4);
    }

    .chat-box {
        flex-grow: 1;
        padding: 15px;
        overflow-y: auto;
        background: var(--bg);
        scroll-behavior: smooth;
    }

    .bot-message, .user-message {
        padding: 12px 16px;
        border-radius: 15px;
        margin-bottom: 12px;
        max-width: 85%;
        font-size: 14px;
        line-height: 1.5;
        animation: fadeIn 0.4s ease;
        word-wrap: break-word;
    }

    .bot-message { 
        background: var(--card); 
        color: var(--text); 
        box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
        border-bottom-left-radius: 2px; 
    }
    
    .user-message { 
        background: var(--primary); 
        color: white; 
        margin-left: auto; 
        border-bottom-right-radius: 2px; 
    }

    .timestamp {
        font-size: 10px;
        text-align: right;
        margin-top: 4px;
        opacity: 0.6;
    }

    .quick-btns {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        padding: 10px;
        background: var(--bg);
        border-top: 1px solid rgba(0,0,0,0.05);
        max-height: 100px;
        overflow-y: auto;
    }

    .quick-btns button {
        font-size: 11px;
        border: none;
        padding: 6px 10px;
        border-radius: 20px;
        background: var(--secondary);
        color: #0d47a1;
        cursor: pointer;
        transition: 0.2s;
        font-weight: 600;
        white-space: nowrap;
    }

    .quick-btns button:hover { 
        background: var(--primary); 
        color: white; 
    }

    .chat-input { 
        display: flex; 
        padding: 10px; 
        background: var(--card); 
        border-top: 1px solid #ddd; 
        gap: 8px;
    }
    
    .chat-input input { 
        flex: 1; 
        padding: 12px; 
        border: 1px solid #ddd; 
        border-radius: 25px; 
        outline: none; 
        padding-left: 20px;
        font-size: 14px;
    }
    
    .chat-input button { 
        background: var(--primary); 
        color: white; 
        border: none; 
        width: 45px; 
        height: 45px; 
        border-radius: 50%; 
        cursor: pointer; 
        display: flex; 
        align-items: center; 
        justify-content: center; 
        font-size: 18px;
        transition: 0.2s;
    }

    .chat-input button:hover {
        background: #0b3d91;
    }

    .error-msg {
        background: #f8d7da;
        color: #721c24;
        padding: 10px;
        border-radius: 5px;
        border-left: 4px solid #f5c6cb;
        font-size: 13px;
    }

    .success-msg {
        background: #d4edda;
        color: #155724;
        padding: 10px;
        border-radius: 5px;
        border-left: 4px solid #c3e6cb;
    }

    @keyframes fadeIn { 
        from { opacity: 0; transform: translateY(5px); } 
        to { opacity: 1; transform: translateY(0); } 
    }

    ::-webkit-scrollbar {
        width: 6px;
    }

    ::-webkit-scrollbar-track {
        background: transparent;
    }

    ::-webkit-scrollbar-thumb {
        background: rgba(0,0,0,0.2);
        border-radius: 3px;
    }
</style>
</head>
<body>

<div class="chat-container">
    <div class="chat-header">
        <span>üéì DSMNRU Helpdesk</span>
        <div class="header-btns">
            <button onclick="toggleDarkMode()" id="themeBtn">üåô</button>
            <button onclick="clearChat()">üóëÔ∏è</button>
        </div>
    </div>

    <div class="chat-box" id="chatBox">
        <div class="bot-message">
            <b>Welcome to DSMNRU!</b> üëã<br>
            I'm your AI assistant for <b>Dr. Shakuntala Misra National Rehabilitation University, Lucknow</b>.<br><br>
            <b>Ask me about:</b><br>
            üìö Courses & Programs<br>
            üí∞ Fees & Scholarships<br>
            üìù Admissions<br>
            üè´ Campus & Facilities<br>
            üíº Placements
        </div>
    </div>

    <div class="quick-btns" id="faqSection">
        <button onclick="quickAsk('What courses does DSMNRU offer?')">üìö Courses</button>
        <button onclick="quickAsk('What are the fees?')">üí∞ Fees</button>
        <button onclick="quickAsk('How do I apply?')">üìù Admission</button>
        <button onclick="quickAsk('What facilities?')">üè´ Facilities</button>
        <button onclick="quickAsk('Contact info')">üìû Contact</button>
        <button onclick="quickAsk('Tell me about placement')">üíº Placement</button>
        <button onclick="quickAsk('Scholarship info')">üéì Scholarships</button>
    </div>

    <div class="chat-input">
        <input type="text" id="userInput" placeholder="Ask about college..." autocomplete="off">
        <button onclick="sendMessage()">‚û§</button>
    </div>
</div>

<script>
    const chatBox = document.getElementById("chatBox");
    const userInput = document.getElementById("userInput");
    const API_KEY = "AIzaSyDC27Mamg5xuIF9aUsABI0Dbx6ENhBFWB8";

    // College Knowledge Base
    const knowledgeBase = {
        courses: "DSMNRU offers 40+ undergraduate, postgraduate and doctoral programs including: B.Tech (CSE, AI-DS, ECE, Mechanical, Civil, Electrical), B.Com, B.Sc, BA, BBA, Law, BASLP, MBA, MCA, M.Tech, M.Sc, M.Com, LLM, M.Ed (Special Education), B.Ed (Special Education), BPO, MPO, and PhD programs across multiple disciplines.",
        
        fees: "Approximate fees (per year): B.Tech ‚Çπ90,000-1.2L | MBA ‚Çπ35,000-45,000 | MCA ‚Çπ30,000-40,000 | BA/B.Sc/B.Com ‚Çπ8,000-15,000 | Law ‚Çπ20,000-30,000 | BASLP ‚Çπ12,000-35,000. NOTE: Divyang (disabled) students get significant fee waivers and scholarships!",
        
        admission: "UG Admissions: Through JEE Main / CUET-UG entrance exam + counseling. PG Admissions: Through CUET-PG or merit-based. PhD: Master's degree + entrance exam/interview. 50% seats are reserved for differently-abled students in all programs. Cut-offs vary by category.",
        
        facilities: "Campus facilities include: Barrier-free 131-acre campus with ramps & elevators | Library with 4000+ books & Braille resources | Smart classrooms with WiFi | Separate boys & girls hostels | Medical center (24/7) | Physiotherapy unit | Sports complex | Cafeteria | IT labs | Assistive technology labs.",
        
        placement: "Average package: ‚Çπ3.2-4.8 LPA. Top placements: MBA up to ‚Çπ12.16 LPA, B.Tech up to ‚Çπ9 LPA. Recruiters: Wipro, HCL, IBM, Amazon, Dabur, Axis Bank, HDFC, Reliance. Active placement cell with training & MoUs.",
        
        scholarships: "Available scholarships: NHFDC Scholarship (for ‚â•40% disability) | UP State Scholarship | Central Govt Divyang Scholarships | Fee reimbursement (category-wise) | Merit-based scholarships. Divyang students receive tuition waiver + maintenance + book support.",
        
        contact: "Address: Mohaan Road, Lucknow, UP - 226017 | Website: https://dsmru.up.nic.in | Registrar: +91 8887222002 | Registrar Email: registrar@dsmnru.ac.in | VC: Prof. Sanjay Singh (vc@dsmnru.ac.in)",
        
        about: "DSMNRU is a state university established in 2009, recognized by UGC and NAAC accredited. It's India's premier institution for inclusive education with 50% horizontal reservation for differently-abled students. Focus: Barrier-free education, rehabilitation, special education. Notable: 2000+ free Braille textbooks printed, sign language notices for hearing-impaired, scented pathways for visually impaired.",
        
        antiRagging: "DSMNRU has a ZERO TOLERANCE policy against ragging. The university strictly enforces anti-ragging rules to ensure a safe and secure campus environment for all students. Any incidents must be reported immediately to college authorities.",
        
        unique: "DSMNRU is unique for: India's only rehabilitation-focused university | 50% disabled student reservation | 2000+ Braille books published | Sign language translation of notices | Scented pathway navigation for blind students | Para-sports excellence | Barrier-free campus design | Specialized assistive tech labs."
    };

    // Initialize
    window.addEventListener("load", () => {
        if (localStorage.getItem("darkMode") === "true") {
            document.body.classList.add('dark-mode');
            document.getElementById("themeBtn").innerText = "‚òÄÔ∏è";
        }
    });

    userInput.addEventListener("keypress", (e) => { 
        if (e.key === "Enter") sendMessage(); 
    });

    function toggleDarkMode() {
        document.body.classList.toggle('dark-mode');
        const isDark = document.body.classList.contains('dark-mode');
        document.getElementById("themeBtn").innerText = isDark ? "‚òÄÔ∏è" : "üåô";
        localStorage.setItem("darkMode", isDark);
    }

    function clearChat() {
        chatBox.innerHTML = `<div class="bot-message"><b>Chat cleared!</b> üëã<br>How can I help you with DSMNRU?</div>`;
    }

    function timeNow() {
        return new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
    }

    function quickAsk(text) {
        userInput.value = text;
        sendMessage();
    }

    // Smart response matcher
    function getSmartResponse(userMsg) {
        const msg = userMsg.toLowerCase();
        
        if (msg.includes("course") || msg.includes("program") || msg.includes("b.tech") || msg.includes("mba")) {
            return knowledgeBase.courses;
        }
        if (msg.includes("fee") || msg.includes("cost") || msg.includes("price")) {
            return knowledgeBase.fees;
        }
        if (msg.includes("admission") || msg.includes("apply") || msg.includes("entrance") || msg.includes("cuet") || msg.includes("jee")) {
            return knowledgeBase.admission;
        }
        if (msg.includes("facility") || msg.includes("campus") || msg.includes("hostel") || msg.includes("library") || msg.includes("sports")) {
            return knowledgeBase.facilities;
        }
        if (msg.includes("placement") || msg.includes("job") || msg.includes("package") || msg.includes("recruit")) {
            return knowledgeBase.placement;
        }
        if (msg.includes("scholarship") || msg.includes("financial") || msg.includes("grant")) {
            return knowledgeBase.scholarships;
        }
        if (msg.includes("contact") || msg.includes("phone") || msg.includes("email") || msg.includes("address") || msg.includes("website")) {
            return knowledgeBase.contact;
        }
        if (msg.includes("ragging") || msg.includes("safety") || msg.includes("discipline")) {
            return knowledgeBase.antiRagging;
        }
        if (msg.includes("unique") || msg.includes("special") || msg.includes("why dsmnru") || msg.includes("disabled") || msg.includes("divyang")) {
            return knowledgeBase.unique;
        }
        if (msg.includes("about") || msg.includes("dsmnru") || msg.includes("university")) {
            return knowledgeBase.about;
        }
        
        return null;
    }

    function sendMessage() {
        const msg = userInput.value.trim();
        if (!msg) return;

        // Add user message
        chatBox.innerHTML += `<div class="user-message">${escapeHtml(msg)}<div class="timestamp">${timeNow()}</div></div>`;
        userInput.value = "";
        
        // Show typing indicator
        const typing = document.createElement("div");
        typing.className = "bot-message";
        typing.id = "typing";
        typing.innerHTML = "<i>‚ú® Checking knowledge base...</i>";
        chatBox.appendChild(typing);
        chatBox.scrollTop = chatBox.scrollHeight;

        // First try to get answer from knowledge base
        const smartResponse = getSmartResponse(msg);
        
        // Remove typing indicator
        const typingEl = document.getElementById("typing");
        if (typingEl) typingEl.remove();

        if (smartResponse) {
            // Use knowledge base response immediately
            chatBox.innerHTML += `<div class="bot-message">${escapeHtml(smartResponse).replace(/\n/g, '<br>')}<div class="timestamp">${timeNow()}</div></div>`;
            chatBox.scrollTop = chatBox.scrollHeight;
        } else {
            // For other questions, try Gemini API or give college-only warning
            callGeminiAPI(msg);
        }
    }

    async function callGeminiAPI(userMessage) {
        try {
            const systemPrompt = `You are a helpful AI for DSMNRU (Dr. Shakuntala Misra National Rehabilitation University). 
            
STRICT RULE: If the user asks about ANYTHING NOT related to DSMNRU college (like celebrities, news, general topics, current affairs, etc.), respond ONLY with:
"üëã I'm here to help with DSMNRU college questions only! Please ask about courses, fees, admission, facilities, placement, scholarships, or contact information."

Do NOT provide any information unrelated to DSMNRU. Keep responses brief and friendly.`;

            const response = await fetch(
                `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${API_KEY}`,
                {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: systemPrompt + "\n\nUser: " + userMessage
                            }]
                        }]
                    })
                }
            );

            let botReply = "Unable to get response. ";

            if (response.ok) {
                const data = await response.json();
                botReply = data.candidates?.[0]?.content?.parts?.[0]?.text || "Unable to generate response";
            } else {
                // If API fails, give friendly fallback
                botReply = "üëã I'm here to help with DSMNRU college questions! Ask about courses, fees, admission, facilities, or contact details.";
            }

            // Add bot response
            chatBox.innerHTML += `<div class="bot-message">${escapeHtml(botReply).replace(/\n/g, '<br>')}<div class="timestamp">${timeNow()}</div></div>`;
            chatBox.scrollTop = chatBox.scrollHeight;

        } catch (error) {
            // Graceful fallback
            const fallbackMsg = "üëã I'm here for DSMNRU college questions! Try asking about courses, fees, admission, placement, or facilities.";
            chatBox.innerHTML += `<div class="bot-message">${fallbackMsg}<div class="timestamp">${timeNow()}</div></div>`;
            chatBox.scrollTop = chatBox.scrollHeight;
        }
    }

    function escapeHtml(text) {
        const map = {
            '&': '&amp;',
            '<': '&lt;',
            '>': '&gt;',
            '"': '&quot;',
            "'": '&#039;'
        };
        return text.replace(/[&<>"']/g, m => map[m]);
    }
</script>

</body>
</html>
